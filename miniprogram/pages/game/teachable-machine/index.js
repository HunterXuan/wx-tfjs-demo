"use strict";var e=require("../../../models/teachable-machine/model.js");require("../../../models/teachable-machine/knn-classifier.js"),require("../../../chunks/base_side_effects.js"),require("../../../models/teachable-machine/util.js"),require("../../../chunks/norm.js"),require("../../../models/mobilenet/model.js"),require("../../../chunks/graph_model.js"),require("../../../chunks/ops.js"),require("../../../chunks/custom_tfjs_core.js"),require("../../../models/mobilenet/classes.js"),require("../../../models/utils/util.js");const t=getApp();Page({ctx:null,frame:null,data:{predictionBlockHeight:t.globalData.systemInfo.screenHeight-t.globalData.systemInfo.screenWidth-t.globalData.menuHeaderHeight,currentSegment:0,predicting:!1,prediction:"样本不足",showHelpModal:!1,imageGroups:[{label:"分类一",images:[]},{label:"分类二",images:[]},{label:"分类三",images:[]}]},onLoad:function(){},onReady:async function(){await this.initModel(),this.ctx=wx.createCameraContext();let e=0;this.ctx.onCameraFrame((t=>{e+=1,3===e&&(e=0,this.frame=t,this.executeClassify(t))})).start()},onUnload:function(){},initModel:async function(){this.showLoadingToast(),await e.load(),this.hideLoadingToast(),e.isReady()||wx.showToast({title:"网络连接异常",icon:"none"})},showLoadingToast(){wx.showLoading({title:"拼命加载模型"})},hideLoadingToast(){wx.hideLoading()},onSegmentChange:function(e){this.setData({currentSegment:e.target.dataset.index})},takeSample:function(){this.addSample(this.data.currentSegment),this.ctx.takePhoto({quality:"normal",success:e=>{let t=this.data.imageGroups;t[this.data.currentSegment].images.push({imagePath:e.tempImagePath}),this.setData({imageGroups:t})}})},cleanSample:function(){let t=this.data.imageGroups;t[this.data.currentSegment].images=[],this.setData({imageGroups:t}),e.clearClass(this.data.currentSegment)},addSample:function(t){e.addExample(this.frame,t)},executeClassify:function(t){e.isReady()&&3==e.getNumClasses()&&!this.data.predicting&&this.setData({predicting:!0},(async()=>{const a=await e.predictClass(t);this.setData({predicting:!1,prediction:this.data.imageGroups[a.classIndex].label})}))},handleInputChange:function(e){const t=this.data.imageGroups;t[this.data.currentSegment].label=e.detail.value,this.setData({imageGroups:t})},showHelp:function(){this.setData({showHelpModal:!0})},hideHelp:function(){this.setData({showHelpModal:!1})},onShareAppMessage:function(){return{title:"AI Pocket - 初识 AI"}}});
