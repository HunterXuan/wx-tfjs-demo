"use strict";var t=require("../../../models/body-pix/model.js");require("../../../chunks/custom_tfjs_core.js"),require("../../../chunks/base_side_effects.js"),require("../../../chunks/norm.js"),require("../../../chunks/ops.js"),require("../../../chunks/graph_model.js"),require("../../../models/utils/util.js");const e=getApp();Page({ctx:null,data:{cameraBlockHeight:e.globalData.systemInfo.screenHeight-e.globalData.menuHeaderHeight,predicting:!1},onLoad:function(){},onReady:async function(){setTimeout((()=>{this.ctx=wx.createCanvasContext("canvas")}),500),await this.initModel();const t=wx.createCameraContext();let e=0;t.onCameraFrame((t=>{e+=1,3===e&&(e=0,this.executeClassify(t))})).start()},onUnload:function(){},initModel:async function(){this.showLoadingToast(),await t.load(),this.hideLoadingToast(),t.isReady()||wx.showToast({title:"网络连接异常",icon:"none"})},executeClassify:async function(a){t.isReady()&&!this.data.predicting&&this.setData({predicting:!0},(async()=>{const i=await t.detectBodySegmentation(a,{width:e.globalData.systemInfo.screenWidth,height:this.data.cameraBlockHeight}),s=t.toMaskImageData(i);wx.canvasPutImageData({canvasId:"canvas",data:s.data,x:0,y:0,width:s.width,height:s.height,complete:()=>{this.setData({predicting:!1})}})}))},showLoadingToast:function(){wx.showLoading({title:"拼命加载模型"})},hideLoadingToast:function(){wx.hideLoading()},onShareAppMessage:function(){return{title:"AI Pocket - 人体检测"}}});
