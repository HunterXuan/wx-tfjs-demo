"use strict";var e=require("../../../models/coco-ssd/model.js");require("../../../chunks/custom_tfjs_core.js"),require("../../../chunks/base_side_effects.js"),require("../../../chunks/norm.js"),require("../../../chunks/ops.js"),require("../../../chunks/graph_model.js"),require("../../../models/utils/util.js");const t=getApp();Page({ctx:null,data:{cameraBlockHeight:t.globalData.systemInfo.screenHeight-t.globalData.menuHeaderHeight,predicting:!1},onLoad:function(){},onReady:async function(){setTimeout((()=>{this.ctx=wx.createCanvasContext("canvas")}),500),await this.initModel();const e=wx.createCameraContext();let t=0;e.onCameraFrame((e=>{t+=1,3===t&&(t=0,this.executeClassify(e))})).start()},initModel:async function(){this.showLoadingToast(),await e.load(),this.hideLoadingToast(),e.isReady()||wx.showToast({title:"网络连接异常",icon:"none"})},showLoadingToast(){wx.showLoading({title:"拼命加载模型"})},hideLoadingToast(){wx.hideLoading()},executeClassify:async function(s){e.isReady()&&!this.data.predicting&&this.setData({predicting:!0},(async()=>{const a=await e.detect(s,{width:t.globalData.systemInfo.screenWidth,height:this.data.cameraBlockHeight});e.drawBoxes(this.ctx,a),this.setData({predicting:!1})}))},onShareAppMessage:function(){return{title:"AI Pocket - 通用物体检测"}}});
